{% extends "base.html" %}
{% block title %}Detalle de Producto{% endblock %}
{% block content %}

<div class="container-fluid fade-in">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="fas fa-box"></i> {{ producto.nombre }}</h2>
        <a href="/inventario-corporativo" class="btn btn-outline-secondary"><i class="fas fa-arrow-left"></i> Volver</a>
    </div>

    <div class="row">
        <div class="col-lg-6">
            <div class="card mb-3">
                <div class="card-body">
                    <p><strong>Código:</strong> {{ producto.codigo_unico }}</p>
                    <p><strong>Categoría:</strong> {{ producto.categoria }}</p>
                    <p><strong>Proveedor:</strong> {{ producto.proveedor }}</p>
                    <p><strong>Valor Unitario:</strong> ${{ "{:,.0f}".format(producto.valor_unitario) }}</p>
                    <p><strong>Stock:</strong> {{ producto.cantidad }} (mín: {{ producto.cantidad_minima or 0 }})</p>
                    <p><strong>Ubicación:</strong> {{ producto.ubicacion or 'No especificada' }}</p>
                    <p><strong>Asignable:</strong> {% if producto.es_asignable %}<span class="badge bg-success">Sí</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}</p>
                    {% if producto.ruta_imagen %}
                    <img src="{{ producto.ruta_imagen if producto.ruta_imagen.startswith('/') else '/' ~ producto.ruta_imagen }}" class="rounded mt-2" style="max-width:240px;">
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card mb-3">
                <div class="card-header bg-light"><strong>Historial de movimientos</strong></div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Acción</th>
                                    <th>Oficina</th>
                                    <th>Cantidad</th>
                                    <th>Usuario</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for h in historial %}
                                <tr>
                                    <td>{{ h.Fecha.strftime('%d/%m/%Y %H:%M') if h.Fecha else '' }}</td>
                                    <td>{{ h.Accion }}</td>
                                    <td>{{ h.oficina or '-' }}</td>
                                    <td>{{ h.Cantidad }}</td>
                                    <td>{{ h.UsuarioAccion }}</td>
                                </tr>
                                {% else %}
                                <tr><td colspan="5" class="text-center text-muted py-3">Sin movimientos</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="d-flex gap-2">
                <a class="btn btn-outline-warning" href="/inventario-corporativo/editar/{{ producto.id }}"><i class="fas fa-edit"></i> Editar</a>
                {% if producto.es_asignable %}
                <a class="btn btn-outline-success" href="/inventario-corporativo/asignar/{{ producto.id }}"><i class="fas fa-share-square"></i> Asignar</a>
                {% endif %}
                <form action="/inventario-corporativo/eliminar/{{ producto.id }}" method="POST" onsubmit="return confirm('¿Eliminar este producto?')">
                    <button class="btn btn-outline-danger"><i class="fas fa-trash"></i> Eliminar</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

