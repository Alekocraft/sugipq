{% extends "base.html" %}

{% block title %}Detalle de Oficina - {{ oficina[1] }}{% endblock %}

{% block content %}
<h1>üè¢ {{ oficina[1] }}</h1>
<a href="/oficinas" class="btn btn-secondary">‚Üê Volver a Oficinas</a>

<div class="row mt-3">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5>üìã Informaci√≥n de la Oficina</h5>
            </div>
            <div class="card-body">
                <p><strong>ID:</strong> {{ oficina[0] }}</p>
                <p><strong>Nombre:</strong> {{ oficina[1] }}</p>
                <p><strong>Director:</strong> {{ oficina[2] if oficina[2] else 'No asignado' }}</p>
                <p>
                    <strong>Email:</strong>
                    {% if oficina[5] %}
                    <a href="mailto:{{ oficina[5] }}">{{ oficina[5] }}</a>
                    {% else %}
                    <span class="text-muted">No especificado</span>
                    {% endif %}
                </p>
                <p><strong>Ubicaci√≥n:</strong> {{ oficina[3] if oficina[3] else 'No especificada' }}</p>
                <p>
                    <strong>Tipo:</strong>
                    {% if oficina[4] == 1 %}
                    <span class="badge bg-primary">Sede Principal</span>
                    {% else %}
                    <span class="badge bg-secondary">Oficina Normal</span>
                    {% endif %}
                </p>
                <p><strong>Estado:</strong> <span class="badge bg-success">Activa</span></p>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5>üìä Estad√≠sticas</h5>
            </div>
            <div class="card-body">
                <p><strong>Materiales Creados:</strong> {{ materiales|length }}</p>
                <p><strong>Solicitudes Realizadas:</strong> {{ solicitudes|length }}</p>
                <p><strong>Solicitudes Pendientes:</strong> {{ solicitudes|selectattr("3", "equalto", "Pendiente")|list|length }}</p>
                <p><strong>Solicitudes Aprobadas:</strong> {{ solicitudes|selectattr("3", "equalto", "Aprobada")|list|length }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-warning text-white">
                <h5>üì¶ Materiales Creados ({{ materiales|length }})</h5>
            </div>
            <div class="card-body">
                {% if materiales %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Valor</th>
                                <th>Stock</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for mat in materiales %}
                            <tr>
                                <td>{{ mat[1] }}</td>
                                <td>${{ "{:,.2f}".format(mat[2]) }}</td>
                                <td>{{ mat[3] }}</td>
                                <td><small>{{ mat[4].strftime('%d/%m/%Y') }}</small></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No hay materiales creados por esta oficina.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5>üìã Solicitudes ({{ solicitudes|length }})</h5>
            </div>
            <div class="card-body">
                {% if solicitudes %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Material</th>
                                <th>Cantidad</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sol in solicitudes %}
                            <tr>
                                <td>#{{ sol[0] }}</td>
                                <td>{{ sol[1] }}</td>
                                <td>{{ sol[2] }}</td>
                                <td>
                                    {% if sol[3] == 'Aprobada' %}
                                    <span class="badge bg-success">Aprobada</span>
                                    {% elif sol[3] == 'Pendiente' %}
                                    <span class="badge bg-warning">Pendiente</span>
                                    {% else %}
                                    <span class="badge bg-secondary">{{ sol[3] }}</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No hay solicitudes realizadas por esta oficina.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}